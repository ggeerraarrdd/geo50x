{% extends "game_layout.html" %}

{% block mapscript %}
<script type="module" src="/static/game_map_geo_review.js"></script>
{% endblock %}

{% block main %}

<div class="container-bottom-map" id="map" 
    map-lat="{{ get_geo_game_review.loc_view_lat }}"
    map-lng="{{ get_geo_game_review.loc_view_lng }}" 
    map-lat-offset="{{ get_geo_game_review.loc_lat_offsets }}" 
    map-zoom="18" 
    locations-right="{{ get_geo_game_review.locations_right }}" 
    locations-wrong="{{ get_geo_game_review.locations_wrong }}" 
    locations-none="{{ get_geo_game_review.locations_none }}" 
    locations-quit="{{ get_geo_game_review.locations_quit }}">

    <script>(g => { var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window; b = b[c] || (b[c] = {}); var d = b.maps || (b.maps = {}), r = new Set, e = new URLSearchParams, u = () => h || (h = new Promise(async (f, n) => { await (a = m.createElement("script")); e.set("libraries", [...r] + ""); for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t[0].toLowerCase()), g[k]); e.set("callback", c + ".maps." + q); a.src = `https://maps.${c}apis.com/maps/api/js?` + e; d[q] = f; a.onerror = () => h = n(Error(p + " could not load.")); a.nonce = m.querySelector("script[nonce]")?.nonce || ""; m.head.append(a) })); d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)) })
            ({ key: "{{ map_api_key }}", v: "beta" });</script>

</div>

<div class="container-bottom-image-main">

    <div class="container-bottom-image-top">
        <div class="container-bottom-image-top-left">
            <div style="display: flex; flex-direction: row; align-items: flex-end;">
                <div style="padding-right: 6px;">
                    <span class="material-symbols-outlined" style="font-size: 28px;">travel_explore</span>
                </div>
                <div>
                    Geofinder #: {{ get_geo_game_review.geofinder_date }}<br>
                    {{ get_geo_game_review.loc_city }}, {{ get_geo_game_review.loc_state }} {{ get_geo_game_review.loc_country }}
                </div>
            </div>
        </div>
        <div class="container-bottom-image-top-right">
            <div class="container-bottom-image-top-right-date">
                {% if get_geo_game_review.locations_right|length == 1 %}
                    Found
                {% else %}
                    Not Found
                {% endif %}
            </div>    
        </div>
    </div>

    <img src="{{ get_geo_game_review.loc_image_source }}" width="400px"><br>

    <div class="container-bottom-image-source">
        <a href="{{ get_geo_game_review.loc_url_source }}" target="_blank" rel="noopener noreferrer">source</a>
    </div>

    <div class="container-bottom-image-markers-label" style=" display: flex; flex-direction: row; justify-content: space-between;">
        <div>
            {% if get_geo_game_review.locations_right|length == 0 and get_geo_game_review.locations_none|length == 0 %}
                Time: na
            {% else %}
                Time: {{ get_geo_game_review.time_clock }}
            {% endif %}
        </div>
        <div>
            Score: na
        </div>
    </div>

    <!-- Attempt with Correct Answer -->
    <div class="container-bottom-image-markers-images" style="border-style: solid; border-width: 0 0 1px 0;">
        {% if get_geo_game_review.locations_right|length == 1 and get_geo_game_review.locations_quit|length == 0 %}
        <?xml version="1.0" encoding="UTF-8"?>
        <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="25px"
            height="35px" viewBox="-0.5 -0.5 45 65"
            style="background-color: #ffffff;">
            <defs />
            <g>
                <rect x="0" y="0" width="44" height="64" fill="#ffffff" stroke="none" pointer-events="all" />
                <rect x="0" y="0" width="44" height="64" fill="#ffffff" stroke="none" pointer-events="all" />
                <path
                    d="M 22 0 L 40.74 30.48 C 42.87 33.94 44 37.93 44 42 C 44 47.83 41.68 53.43 37.56 57.56 C 33.43 61.68 27.83 64 22 64 C 9.85 64 0 54.15 0 42 C 0 37.93 1.13 33.94 3.26 30.48 Z"
                    fill="#D95040" stroke="#B31312" stroke-width="0.5" stroke-miterlimit="10"
                    transform="rotate(-180,22,32)" pointer-events="all" />
                <ellipse cx="22" cy="23" rx="9" ry="9" fill="#FFFF00" stroke="none" pointer-events="all" />
            </g>
        </svg>
        {% else %}
        {% endif %}

        <!-- Attempt with Quit -->
        {% if get_geo_game_review.locations_right|length == 0 and (get_geo_game_review.locations_quit|length == 1 or get_geo_game_review.locations_none|length == 0) %}
        <?xml version="1.0" encoding="UTF-8"?>
        <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="25px"
            height="35px" viewBox="-0.5 -0.5 45 65"
            style="background-color: #ffffff;">
            <defs />
            <g>
                <rect x="0" y="0" width="44" height="64" fill="#ffffff" stroke="none" pointer-events="all" />
                <rect x="0" y="0" width="44" height="64" fill="#ffffff" stroke="none" pointer-events="all" />
                <path
                    d="M 22 0 L 40.74 30.48 C 42.87 33.94 44 37.93 44 42 C 44 47.83 41.68 53.43 37.56 57.56 C 33.43 61.68 27.83 64 22 64 C 9.85 64 0 54.15 0 42 C 0 37.93 1.13 33.94 3.26 30.48 Z"
                    fill="#D95040" stroke="#B31312" stroke-width="0.5" stroke-miterlimit="10"
                    transform="rotate(-180,22,32)" pointer-events="all" />
                <ellipse cx="22" cy="23" rx="9" ry="9" fill="#000000" stroke="none" pointer-events="all" />
            </g>
        </svg>
        {% else %}
        {% endif %}

        <!-- Attempts with Wrong Answers -->
        {% for _ in range(get_geo_game_review.locations_wrong|length) %}
        <?xml version="1.0" encoding="UTF-8"?>
        <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="25px"
            height="35px" viewBox="-0.5 -0.5 45 65"
            style="background-color: #ffffff;">
            <defs />
            <g>
                <rect x="0" y="0" width="44" height="64" fill="#ffffff" stroke="none" pointer-events="all" />
                <rect x="0" y="0" width="44" height="64" fill="#ffffff" stroke="none" pointer-events="all" />
                <path
                    d="M 22 0 L 40.74 30.48 C 42.87 33.94 44 37.93 44 42 C 44 47.83 41.68 53.43 37.56 57.56 C 33.43 61.68 27.83 64 22 64 C 9.85 64 0 54.15 0 42 C 0 37.93 1.13 33.94 3.26 30.48 Z"
                    fill="#D95040" stroke="#B31312" stroke-width="0.5" stroke-miterlimit="10"
                    transform="rotate(-180,22,32)" pointer-events="all" />
                <ellipse cx="22" cy="23" rx="9" ry="9" fill="#D95040" stroke="none" pointer-events="all" />
            </g>
        </svg>
        {% endfor %}

        <!-- Attempts with No Answers -->
        {% for _ in range(get_geo_game_review.locations_none|length) %}
        <?xml version="1.0" encoding="UTF-8"?>
        <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="25px"
            height="35px" viewBox="-0.5 -0.5 45 65"
            style="background-color: #FFFFFF;">
            <defs />
            <g>
                <rect x="0" y="0" width="44" height="64" fill="#FFFFFF" stroke="none" pointer-events="all" />
                <rect x="0" y="0" width="44" height="64" fill="#FFFFFF" stroke="none" pointer-events="all" />
                <path
                    d="M 22 0 L 40.74 30.48 C 42.87 33.94 44 37.93 44 42 C 44 47.83 41.68 53.43 37.56 57.56 C 33.43 61.68 27.83 64 22 64 C 9.85 64 0 54.15 0 42 C 0 37.93 1.13 33.94 3.26 30.48 Z"
                    fill="#FFFFFF" stroke="gray" stroke-width="1.5" stroke-miterlimit="10"
                    transform="rotate(-180,22,32)" pointer-events="all" />
                <ellipse cx="22" cy="23" rx="9" ry="9" fill="#FFFFFF" stroke="none" pointer-events="all" />
            </g>
        </svg>
        {% endfor %}

    </div> 

    <div class="container-bottom-image-buttons" style="padding-top: 15px; align-items: center;">
        <div class="container-bottom-image-buttons-left">
            <form name="submit" action="/geofinder/review" method="post">
                <input type="hidden" name="page" class="hidden-field" value="geofinder_review"></input>
                <input type="hidden" name="goto" class="hidden-field" value="dash_geofinder"></input>
                <input type="hidden" name="nav" class="hidden-field" value="yes"></input>
                <input type="hidden" name="bttn" class="hidden-field" value="dash_geofinder"></input>
                <button name="submit" class="bttn bttn-xsmall bttn-naked" type="submit">
                    Next Game in &nbsp; <span id="countdown"></span>
                    <script>
                        const countdownToMidnight = () => {
                            let now = new Date();
                            let midnight = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0);
                            let diffInSeconds = Math.floor((midnight - now) / 1000);

                            let hours = Math.floor(diffInSeconds / 3600);
                            diffInSeconds %= 3600;
                            let minutes = Math.floor(diffInSeconds / 60);
                            let seconds = diffInSeconds % 60;

                            document.getElementById("countdown").innerHTML = `${hours}h ${minutes}m ${seconds}s`;

                            if(hours === 0 && minutes === 0 && seconds === 0) {
                                clearInterval(countdown);
                            }
                        }
                        const countdown = setInterval(countdownToMidnight, 1000);
                    </script>
                </button>
            </form>
        </div> 
        <div class="container-bottom-image-buttons-right">
            <div class="container-bottom-image-buttons-quit">
            </div>
            <form name="submit" action="/geofinder/review" method="post">
                <input type="hidden" name="page" class="hidden-field" value="geofinder_review"></input>
                <input type="hidden" name="goto" class="hidden-field" value="dash_geofinder"></input>
                <input type="hidden" name="nav" class="hidden-field" value="yes"></input>
                <input type="hidden" name="bttn" class="hidden-field" value="dash_geofinder"></input>
                <button name="submit" class="bttn bttn-xsmall" type="submit">Search History</button>
            </form>
        </div>
    </div>
    
</div>      

{% endblock %}